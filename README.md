# terraform-aws-static-website-s3-cloudfront-acm

This Terraform deploys resources for a public static website using AWS S3 and Cloudfront with TLS and a public DNS entry together with a suitable ACM certificate and validation. The apex domain is aliased to the www subdomain. This is a useful base from which to deploy website content with e.g. Hugo. Optionally a sample webpage with text and an image may be deployed to demonstrate that the website is working. This code presumes that a hosted zone already exists in the same account for the domain in question - this is automatically provisioned for public domain names registered via Route53 as opposed to transferred from another provider. There are a bewilderment of options available for Cloudfront and S3. It simply isn't practical to include all possible options here. The choices made are appropriate for a personal website.

By default 404 and 403 errors are redirected to `/index.html` but this is configurable and custom error responses may be specified as demonstrated in the accompanying `examples/custom-error-response-and-bucket`

## Requirements

| Name                                                                     | Version   |
| ------------------------------------------------------------------------ | --------- |
| <a name="requirement_terraform"></a> [terraform](#requirement_terraform) | >= 1.2.8  |
| <a name="requirement_aws"></a> [aws](#requirement_aws)                   | >= 4.29.0 |

## Providers

| Name                                                                           | Version   |
| ------------------------------------------------------------------------------ | --------- |
| <a name="provider_aws"></a> [aws](#provider_aws)                               | >= 4.29.0 |
| <a name="provider_aws.us-east-1"></a> [aws.us-east-1](#provider_aws.us-east-1) | >= 4.29.0 |

## Modules

No modules.

## Resources

| Name                                                                                                                                                      | Type        |
| --------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- |
| [aws_acm_certificate.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/acm_certificate)                                   | resource    |
| [aws_acm_certificate_validation.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/acm_certificate_validation)             | resource    |
| [aws_cloudfront_distribution.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution)                   | resource    |
| [aws_cloudfront_origin_access_control.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_origin_access_control) | resource    |
| [aws_route53_record.domain_name](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route53_record)                              | resource    |
| [aws_route53_record.validation](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route53_record)                               | resource    |
| [aws_route53_record.www_domain_name](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route53_record)                          | resource    |
| [aws_s3_bucket.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket)                                               | resource    |
| [aws_s3_bucket_policy.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_policy)                                 | resource    |
| [aws_s3_bucket_public_access_block.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block)       | resource    |
| [aws_s3_bucket_versioning.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_versioning)                         | resource    |
| [aws_s3_object.sample_image](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_object)                                       | resource    |
| [aws_s3_object.sample_index_html](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_object)                                  | resource    |
| [aws_iam_policy_document.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document)                        | data source |
| [aws_route53_zone.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/route53_zone)                                      | data source |

## Inputs

| Name                                                                                                                                       | Description                                                                                                | Type                                                                                                                                                   | Default                                                                                                                                                                                                                                                                                        | Required |
| ------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------: |
| <a name="input_cloudfront_custom_error_responses"></a> [cloudfront_custom_error_responses](#input_cloudfront_custom_error_responses)       | See https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/GeneratingCustomErrorResponses.html | <pre>list(object({<br> error_code = number<br> response_code = number<br> error_caching_min_ttl = number<br> response_page_path = string<br> }))</pre> | <pre>[<br> {<br> "error_caching_min_ttl": 10,<br> "error_code": 403,<br> "response_code": 404,<br> "response_page_path": "/index.html"<br> },<br> {<br> "error_caching_min_ttl": 10,<br> "error_code": 404,<br> "response_code": 404,<br> "response_page_path": "/index.html"<br> }<br>]</pre> |    no    |
| <a name="input_cloudfront_default_root_object"></a> [cloudfront_default_root_object](#input_cloudfront_default_root_object)                | Default root object for cloudfront. Need to also provide custom error response if changing from default    | `string`                                                                                                                                               | `"index.html"`                                                                                                                                                                                                                                                                                 |    no    |
| <a name="input_cloudfront_default_ttl"></a> [cloudfront_default_ttl](#input_cloudfront_default_ttl)                                        | The default TTL for the cloudfront cache                                                                   | `number`                                                                                                                                               | `86400`                                                                                                                                                                                                                                                                                        |    no    |
| <a name="input_cloudfront_max_ttl"></a> [cloudfront_max_ttl](#input_cloudfront_max_ttl)                                                    | The maximum TTL for the cloudfront cache                                                                   | `number`                                                                                                                                               | `31536000`                                                                                                                                                                                                                                                                                     |    no    |
| <a name="input_cloudfront_min_ttl"></a> [cloudfront_min_ttl](#input_cloudfront_min_ttl)                                                    | The minimum TTL for the cloudfront cache                                                                   | `number`                                                                                                                                               | `0`                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_cloudfront_minimum_protocol_version"></a> [cloudfront_minimum_protocol_version](#input_cloudfront_minimum_protocol_version) | The minimum version of the SSL protocol that you want CloudFront to use for HTTPS connections.             | `string`                                                                                                                                               | `"TLSv1.2_2019"`                                                                                                                                                                                                                                                                               |    no    |
| <a name="input_cloudfront_price_class"></a> [cloudfront_price_class](#input_cloudfront_price_class)                                        | CloudFront distribution price class                                                                        | `string`                                                                                                                                               | `"PriceClass_100"`                                                                                                                                                                                                                                                                             |    no    |
| <a name="input_deploy_sample_content"></a> [deploy_sample_content](#input_deploy_sample_content)                                           | Deploy sample content to show website working?                                                             | `bool`                                                                                                                                                 | `false`                                                                                                                                                                                                                                                                                        |    no    |
| <a name="input_domain_name"></a> [domain_name](#input_domain_name)                                                                         | Domain name for website, used for all resources                                                            | `string`                                                                                                                                               | n/a                                                                                                                                                                                                                                                                                            |   yes    |
| <a name="input_s3_bucket_custom_name"></a> [s3_bucket_custom_name](#input_s3_bucket_custom_name)                                           | Any non-empty string here will replace default name of bucket `var.domain_name`                            | `string`                                                                                                                                               | `""`                                                                                                                                                                                                                                                                                           |    no    |
| <a name="input_s3_bucket_public_access_block"></a> [s3_bucket_public_access_block](#input_s3_bucket_public_access_block)                   | Apply public access block to S3 bucket?                                                                    | `bool`                                                                                                                                                 | `true`                                                                                                                                                                                                                                                                                         |    no    |
| <a name="input_s3_bucket_versioning"></a> [s3_bucket_versioning](#input_s3_bucket_versioning)                                              | Apply versioning to S3 bucket?                                                                             | `bool`                                                                                                                                                 | `false`                                                                                                                                                                                                                                                                                        |    no    |

## Outputs

| Name                                                                                                              | Description                                         |
| ----------------------------------------------------------------------------------------------------------------- | --------------------------------------------------- |
| <a name="output_acm_certificate_id"></a> [acm_certificate_id](#output_acm_certificate_id)                         | n/a                                                 |
| <a name="output_cloudfront_distribution_id"></a> [cloudfront_distribution_id](#output_cloudfront_distribution_id) | n/a                                                 |
| <a name="output_cloudfront_domain_name"></a> [cloudfront_domain_name](#output_cloudfront_domain_name)             | n/a                                                 |
| <a name="output_s3_bucket_arn"></a> [s3_bucket_arn](#output_s3_bucket_arn)                                        | n/a                                                 |
| <a name="output_s3_bucket_id"></a> [s3_bucket_id](#output_s3_bucket_id)                                           | n/a                                                 |
| <a name="output_s3_bucket_name"></a> [s3_bucket_name](#output_s3_bucket_name)                                     | deprecated and will be removed - use `s3_bucket_id` |
